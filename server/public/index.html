<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#050505">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ORBIT">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="apple-touch-startup-image" href="icons/icon-512.png">
    <title>ORBIT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css?v=chart-fix">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
    <div class="app">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <div class="header-text">
                <h1 class="orbit-title">ORBIT</h1>
                <div class="orbit-tagline">YOUR GRAVITY</div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" id="btn-new-habit">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                </button>
                <button class="icon-btn" id="btn-settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                </button>
            </div>
        </header>

        <!-- Today's Progress -->
        <section class="today-section" id="today-section">
            <div class="today-header">
                <span class="today-date" id="today-date">Today</span>
                <span class="today-progress" id="today-progress">0/0</span>
            </div>
            <!-- Quote -->
            <div class="quote-container" id="quote-container">
                "Habits are the compound interest of self-improvement."
            </div>
            <div class="today-habits" id="today-habits">
                <!-- Quick toggle habits for today -->
            </div>
        </section>

        <!-- Onboarding Section (Carousel) -->
        <section class="onboarding-section" id="onboarding-section" style="display: none;">
            <div class="onboarding-wrapper">
                <div class="onboarding-slides" id="onboarding-slides">
                    <!-- Slide 1: Define -->
                    <div class="onboarding-slide">
                        <div class="preview-card">
                            <div class="preview-header">MY HABITS</div>
                            <div class="preview-list">
                                <div class="preview-row">
                                    <div class="preview-icon">üìö</div>
                                    <div class="preview-text">Reading</div>
                                    <div class="preview-check">‚úì</div>
                                </div>
                                <div class="preview-row">
                                    <div class="preview-icon">üèÉ</div>
                                    <div class="preview-text">Morning Run</div>
                                    <div class="preview-check"></div>
                                </div>
                                <div class="preview-row">
                                    <div class="preview-icon">üíß</div>
                                    <div class="preview-text">Drink Water</div>
                                    <div class="preview-check">‚úì</div>
                                </div>
                            </div>
                        </div>
                        <h2>Define Habits</h2>
                        <p>Choose what you want to improve. From reading to fitness, set your weekly goals.</p>
                    </div>

                    <!-- Slide 2: Track -->
                    <div class="onboarding-slide">
                        <div class="preview-card">
                            <div class="preview-chart-container">
                                <svg viewBox="0 0 100 50" class="preview-wave">
                                    <path d="M0 40 C 30 40, 30 10, 50 20 C 70 30, 80 5, 100 15 V 50 H 0 Z" fill="url(#grad2)" fill-opacity="0.2"></path>
                                    <path d="M0 40 C 30 40, 30 10, 50 20 C 70 30, 80 5, 100 15" stroke="#30D158" stroke-width="3" fill="none"></path>
                                    <defs>
                                        <linearGradient id="grad2" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#30D158;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#30D158;stop-opacity:0" />
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <div class="preview-stats">
                                    <span>üî• 12 Day Streak</span>
                                </div>
                            </div>
                        </div>
                        <h2>Track Progress</h2>
                        <p>Check-in daily. Watch your effectiveness trend rise and build momentum.</p>
                    </div>

                    <!-- Slide 3: Action -->
                    <div class="onboarding-slide">
                        <div class="preview-hero">
                            <div class="orbit-logo-large">
                                <div class="orbit-ring"></div>
                                <div class="orbit-core"></div>
                            </div>
                        </div>
                        <h2>Start Your Orbit</h2>
                        <p>"Habits are the compound interest of self-improvement."</p>
                        <button class="btn btn-primary btn-large pulse-btn" id="btn-start-onboarding">
                            Get Started
                        </button>
                    </div>
                </div>
                
                <div class="onboarding-pagination">
                    <div class="dot active"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
        </section>

        <!-- Log Section (Chart + Calendar) - Moved Up -->
        <section class="log-section" id="log-section">
            <div class="log-tabs" id="log-tabs">
                <button class="log-tab active" data-view="chart">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 6l-9.5 9.5-5-5L1 18"></path><path d="M17 6h6v6"></path></svg>
                    Trend
                </button>
                <button class="log-tab" data-view="calendar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                    Calendar
                </button>
            </div>
            <div class="log-content">
                <div class="chart-container" id="chart-container">
                    <canvas id="trend-chart"></canvas>
                </div>
                <div class="calendar-container" id="calendar-container" style="display: none;"></div>
            </div>
        </section>

        <!-- Habits List -->
        <section class="habits-section" id="habits-section">
            <div class="section-title">All Habits</div>
            <div class="habits-grid" id="habits-grid">
                <!-- Habit cards -->
            </div>
        </section>
    </div>

    <!-- Modal for Create/Edit Habit -->
    <div class="modal" id="habit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">New Habit</h3>
                <button class="modal-close" id="modal-close">√ó</button>
            </div>
            <form id="habit-form">
                <input type="hidden" id="habit-id">
                
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="habit-name" placeholder="e.g. Reading" required>
                </div>
                
                <div class="form-group">
                    <label>Icon</label>
                    <div class="icon-picker-container">
                        <input type="hidden" id="habit-icon">
                        <div class="selected-icon-preview" id="selected-icon-preview">
                            <!-- Selected icon SVG will go here -->
                        </div>
                        <div class="icon-grid" id="icon-grid">
                            <!-- Icons injected by JS -->
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Frequency</label>
                        <select id="habit-frequency">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Goal/week</label>
                        <input type="number" id="habit-goal" min="1" max="7" value="7">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Color</label>
                    <input type="hidden" id="habit-color">
                    <div class="color-palette" id="color-palette">
                        <!-- Colors injected by JS -->
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="btn-delete-habit" style="display: none;">Delete</button>
                    <button type="button" class="btn btn-secondary" id="btn-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Day Detail Modal -->
    <div class="modal" id="day-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="day-modal-title">Day Details</h3>
                <button class="modal-close" id="day-modal-close">√ó</button>
            </div>
            <div class="day-modal-body" id="day-modal-body"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="modal-close" id="settings-close">√ó</button>
            </div>
            <div class="settings-section">
                <h4>Data</h4>
                <button class="btn btn-secondary btn-block" id="btn-export">Export JSON</button>
                <button class="btn btn-secondary btn-block" id="btn-import">Import JSON</button>
                <input type="file" id="import-file" accept=".json" style="display:none">
            </div>
            <div class="settings-section">
                <h4>Demo</h4>
                <button class="btn btn-secondary btn-block" id="btn-load-demo">Load Demo Data</button>
                <button class="btn btn-danger btn-block" id="btn-reset">Reset All</button>
            </div>
        </div>
    </div>

    <div id="update-toast" class="update-toast">
        New version available! <button id="btn-refresh">Refresh</button>
    </div>
    
    <script src="js/data.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
